#!/usr/bin/env bash

set -ex

THIS_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" >/dev/null 2>&1 && pwd )"





# Create a PVC manifest file.
# Usage: create_pvc_manifest <pvc_name> <namespace> [storageClassName] [accessModes] [storage]
create_pvc_manifest() {
    local help_text="Usage: create_pvc <pvc_name> <namespace> [storageClassName] [accessModes] [storage]"

	local pvc_name="${1:?$help_text}"
	local namespace="${2:?$help_text}"
	local storage_class="${3:-standard}"
	local access_modes="${4:-ReadWriteMany}"
	local storage="${5:-10Gi}"

	mkdir -p "$THIS_DIR/k8s"
	cat <<EOF > "$THIS_DIR/k8s/pvc_.yaml"
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: $pvc_name
  namespace: $namespace
spec:
  accessModes:
    - $access_modes
  storageClassName: $storage_class
  resources:
    requests:
      storage: $storage
EOF
	echo "Wrote k8s/pvc.yaml"
}


# remove all files generated by tests, builds, or operating this codebase
clean() {
	set -x

	rm -rf dist build coverage.xml test-reports/
	find . \
	  -type d \
	  \( \
		-name "*cache*" \
		-o -name "*.dist-info" \
		-o -name "*.egg-info" \
		-o -name "*htmlcov" \
        -o -name "cdk.out" \
	  \) \
	  -not -path "*env*/*" \
	  -exec rm -r {} + || true

	find . \
	  -type f \
	  -name "*.pyc" \
	  -not -path "*env/*" \
	  -exec rm {} +
}


# print all functions in this file
help() {
    echo "$0 <task> <args>"
    echo "Tasks:"
    compgen -A function | cat -n
}


TIMEFORMAT="Task completed in %3lR"
time ${@:-help}